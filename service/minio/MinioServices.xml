<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-3.xsd">

    <!-- 创建桶 -->
    <service verb="create" noun="Bucket" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="createBucket"
             authenticate="true">
        <description>Create a new bucket via MinioServiceRunner</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true">
                <description>Unique identifier for the bucket (also used as MinIO bucket name)</description>
            </parameter>
            <parameter name="userId" type="String" required="true">
                <description>User who will own the bucket</description>
            </parameter>
            <parameter name="bucketName" type="String" required="false">
                <description>Display name for the bucket (defaults to bucketId if not provided)</description>
            </parameter>
            <parameter name="description" type="String" required="false">
                <description>Optional description for the bucket</description>
            </parameter>
            <parameter name="quotaLimit" type="Long" required="false" default-value="5368709120">
                <description>Quota limit in bytes (default: 5GB)</description>
            </parameter>
            <parameter name="isPublic" type="String" required="false" default-value="N">
                <description>Whether the bucket is publicly accessible (Y/N)</description>
            </parameter>
            <parameter name="versioning" type="String" required="false" default-value="N">
                <description>Whether versioning is enabled (Y/N)</description>
            </parameter>
            <parameter name="encryption" type="String" required="false" default-value="N">
                <description>Whether server-side encryption is enabled (Y/N)</description>
            </parameter>
            <parameter name="region" type="String" required="false">
                <description>MinIO region/zone</description>
            </parameter>
            <parameter name="tags" type="String" required="false">
                <description>JSON formatted tags for the bucket</description>
            </parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="bucketId" type="String"/>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 删除桶 -->
    <service verb="delete" noun="Bucket" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="deleteBucket"
             authenticate="true">
        <description>Delete a bucket via MinioServiceRunner</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true">
                <description>Unique identifier for the bucket to delete</description>
            </parameter>
            <parameter name="userId" type="String" required="true">
                <description>User who owns the bucket</description>
            </parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 列表桶（支持分页） -->
    <service verb="list" noun="Bucket" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="listBucket"
             authenticate="true">
        <description>List buckets for a specific user via MinioServiceRunner with pagination support</description>
        <in-parameters>
            <parameter name="userId" type="String" required="true">
                <description>User whose buckets to list</description>
            </parameter>
            <parameter name="status" type="String" required="false">
                <description>Filter by status (ACTIVE, INACTIVE, ERROR, etc.)</description>
            </parameter>
            <parameter name="isPublic" type="String" required="false">
                <description>Filter by public access (Y/N)</description>
            </parameter>
            <parameter name="scope" type="String" required="false">
                <description>Scope of listing: 'all' for admin view, default for user's buckets</description>
            </parameter>
            <!-- 分页参数 -->
            <parameter name="pageIndex" type="Integer" required="false" default-value="0">
                <description>Page index for pagination (0-based)</description>
            </parameter>
            <parameter name="pageSize" type="Integer" required="false" default-value="20">
                <description>Number of records per page</description>
            </parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="bucketList" type="List">
                <description>List of bucket information maps for current page</description>
            </parameter>
            <parameter name="bucketListCount" type="Integer">
                <description>Total number of buckets found (for pagination)</description>
            </parameter>
            <parameter name="totalCount" type="Integer">
                <description>Total number of buckets found</description>
            </parameter>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 更新桶信息 -->
    <service verb="update" noun="Bucket" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="updateBucket"
             authenticate="true">
        <description>Update bucket information</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true"/>
            <parameter name="userId" type="String" required="true"/>
            <parameter name="bucketName" type="String" required="false"/>
            <parameter name="description" type="String" required="false"/>
            <parameter name="quotaLimit" type="Long" required="false"/>
            <parameter name="tags" type="String" required="false"/>
        </in-parameters>
        <out-parameters>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 获取桶详细信息 -->
    <service verb="get" noun="Bucket" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="getBucket"
             authenticate="true">
        <description>Get detailed bucket information</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true"/>
            <parameter name="userId" type="String" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="bucketInfo" type="Map"/>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 上传对象 -->
    <service verb="upload" noun="Object" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="uploadObject"
             authenticate="true">
        <description>Upload an object to MinIO bucket</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true"/>
            <parameter name="userId" type="String" required="true"/>
            <parameter name="objectName" type="String" required="true"/>
            <parameter name="fileBytes" type="byte[]" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="objectName" type="String"/>
            <parameter name="objectSize" type="Long"/>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 删除对象 -->
    <service verb="delete" noun="Object" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="deleteObject"
             authenticate="true">
        <description>Delete an object from MinIO bucket</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true"/>
            <parameter name="userId" type="String" required="true"/>
            <parameter name="objectName" type="String" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 列出对象 -->
    <service verb="list" noun="Objects" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="listObjects"
             authenticate="true">
        <description>List objects in a MinIO bucket</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true"/>
            <parameter name="userId" type="String" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="objects" type="List"/>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

    <!-- 下载对象 -->
    <service verb="download" noun="Object" type="java"
             location="org.moqui.impl.service.runner.MinioServiceRunner"
             method="downloadObject"
             authenticate="true">
        <description>Generate download URL for a MinIO object</description>
        <in-parameters>
            <parameter name="bucketId" type="String" required="true"/>
            <parameter name="userId" type="String" required="true"/>
            <parameter name="objectName" type="String" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="downloadUrl" type="String"/>
            <parameter name="success" type="Boolean"/>
        </out-parameters>
    </service>

</services>